# Comments

When a is created it is derived from a snapshot key. The subkey id is stored together with the comment. The purpose of this is so everyone with access to the snapshot key can decrypt the comment.

And everytime a new Snapshot is taking all the existing commentIds and related keys are stored in the Yjs doccument and the old entries are cleaned out and then they are not accessible anymore to new users or page share links.

Still to be determined what clean out old comments mean. Most probably every comment that is not referenced in the current document.

## Test flows

### Test Flow 1

- Create a workspace and invite a user B
- Create a document (snapshot key A)
- Create a sharelink X
- Remove user B from the workspace
- Make an update to document (snapshot key B)
  - Add a lockbox for sharelink X
- Sharelink X should be valid

### Test Flow 2

- Create a workspace and invite a user B
- Create a document (snapshot key A)
- Create a comment
- Remove user B from the workspace
- Make an update to document (snapshot key B)
- Create a sharelink X
  - Add a lockbox for sharelink X to snapshotKey B

## Autenticity

TODO how to sign the comment to proof that it is from the user that created it.
