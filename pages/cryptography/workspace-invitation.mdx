# Workspace Invitation

# Invitation

## Overview

A user can only join a workspace through a workspace invitation link. The invitation link is generated by a workspace admin and has to be sent to the invitee out-of-band. The invitee can then use the link to join the workspace.

Once the invitee clicks on the link, they can decide to ignore or accept the invitation. If they accept the invitation, they will be addded to the workspace as non-authorized user.

Any other user can authorize them, which is happening automatically and once the invitee is authorized, they get access to the workspace.

## Why?

The goal was to provide a way to add users to a workspace that

1. follows a familiar flow in modern SaaS apps
2. allows to establish a secure trust relationship between the invitee and the existing workspace members without the server infrustructure ever beeing able to access invitees private data

Invitation link sharing has become a popular invitation method e.g. Slack, Figma and therefor was chosen as the way to invite users to a workspace.

In order to establish a secure trust relationship the invitation link contains a secret that is only known to the invitee and the inviter.

## Invitation link structure

TODO

## Invitation flow

1. Alice creates the invitation and adds it to the chain
2. Alice send the private key to Bob
3. Bob can sign with the private key the

   - invitation data (so nothing can be forged)
   - main device info

4. Alice or Charlie (member then can add a chain entry to add Bob as a member) - they must add the signature created by Bob as proof, they also must check that the expiration date is not passed

## Revocation

Any workspace admin can revoke an invitation at any point. The purpose is to make sure any workspace invitation link can be revoked if it is compromised.

## References

- https://book.keybase.io/docs/teams/seitan
- https://github.com/local-first-web/auth

![Workspace Invitation flow](./workspace-invitation-flow.png)
Note: best to open in a separate tab

In case the user succeeds

// TODO accept pending workspace invitations

https://github.com/serenity-kit/Serenity/blob/main/apps/app/utils/authentication/loginHelper.ts#L209C14-L220

Then the client queries for pending workspace invitations, validates them and accepts them. Such a pending workspace invitation can only exist if the user signed up on the workspace invitation page.

https://github.com/serenity-kit/Serenity/blob/main/apps/app/navigation/screens/registrationVerificationScreen/RegistrationVerificationScreen.tsx#L67-L119

https://github.com/serenity-kit/Serenity/blob/main/apps/app/utils/workspace/acceptWorkspaceInvitation.ts

https://github.com/serenity-kit/Serenity/blob/main/packages/common/src/encryptWorkspaceInvitationKey/encryptWorkspaceInvitationKey.ts

https://github.com/serenity-kit/Serenity/blob/main/packages/common/src/decryptWorkspaceInvitationKey/decryptWorkspaceInvitationKey.ts

https://github.com/serenity-kit/Serenity/blob/main/apps/app/navigation/screens/acceptWorkspaceInvitationScreen/AcceptWorkspaceInvitationScreen.tsx#L79
